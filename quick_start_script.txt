@echo off
REM Quick Start Script for Visitor Counting System (Windows)

echo ========================================
echo Visitor Counting System - Quick Start
echo ========================================
echo.

REM Check if virtual environment exists
if not exist "venv\" (
    echo [1/5] Creating virtual environment...
    python -m venv venv
    if errorlevel 1 (
        echo ERROR: Failed to create virtual environment
        pause
        exit /b 1
    )
    echo Virtual environment created successfully!
    echo.
) else (
    echo [1/5] Virtual environment already exists
    echo.
)

REM Activate virtual environment
echo [2/5] Activating virtual environment...
call venv\Scripts\activate.bat
echo.

REM Check if PyTorch is installed
python -c "import torch" 2>nul
if errorlevel 1 (
    echo [3/5] Installing PyTorch with CUDA 12.1...
    echo This may take several minutes...
    pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121
    if errorlevel 1 (
        echo ERROR: Failed to install PyTorch
        pause
        exit /b 1
    )
    echo PyTorch installed successfully!
    echo.
) else (
    echo [3/5] PyTorch already installed
    echo.
)

REM Check if ultralytics is installed
python -c "import ultralytics" 2>nul
if errorlevel 1 (
    echo [4/5] Installing dependencies...
    pip install ultralytics opencv-python opencv-contrib-python numpy requests lap
    if errorlevel 1 (
        echo ERROR: Failed to install dependencies
        pause
        exit /b 1
    )
    echo Dependencies installed successfully!
    echo.
) else (
    echo [4/5] Dependencies already installed
    echo.
)

REM Verify CUDA
echo [5/5] Verifying GPU setup...
python -c "import torch; print(f'CUDA Available: {torch.cuda.is_available()}'); print(f'GPU: {torch.cuda.get_device_name(0) if torch.cuda.is_available() else \"None\"}')"
echo.

REM Check if main.py exists
if not exist "main.py" (
    echo WARNING: main.py not found in current directory!
    echo Please ensure main.py is in the same folder as this script.
    pause
    exit /b 1
)

REM Check if rtsp_urls.txt exists
if not exist "rtsp_urls.txt" (
    echo WARNING: rtsp_urls.txt not found!
    echo Creating template file...
    echo # Add your RTSP URLs here (one per line) > rtsp_urls.txt
    echo # Example: rtsp://admin:12345@192.168.5.227/71 >> rtsp_urls.txt
    echo.
    echo Please edit rtsp_urls.txt with your camera URLs and run this script again.
    pause
    exit /b 1
)

REM Check if bytetrack.yaml exists
if not exist "bytetrack.yaml" (
    echo WARNING: bytetrack.yaml not found!
    echo The application will use default tracking settings.
    echo Consider creating bytetrack.yaml for optimized tracking.
    echo.
)

echo ========================================
echo Setup complete! Starting application...
echo ========================================
echo.
echo Press Ctrl+C to stop the application
echo.

REM Run the application
python main.py

REM Pause if there was an error
if errorlevel 1 (
    echo.
    echo Application exited with an error.
    pause
)
